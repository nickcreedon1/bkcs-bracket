<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BKCS Croquet Tournament Bracket</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
      color: #333;
    }
    header {
      background-color: #2e7d32;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .bracket-container {
      display: flex;
      overflow-x: auto;
      padding: 2rem;
      gap: 3rem;
      align-items: flex-start;
      position: relative;
    }
    .round {
      display: flex;
      flex-direction: column;
      gap: 2rem;
      position: relative;
    }
    .round h3 {
      text-align: center;
      color: #2e7d32;
      margin-bottom: 0.5rem;
    }
    .match {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 1rem;
      text-align: center;
      min-width: 180px;
      position: relative;
    }
    .team {
      font-weight: bold;
      margin: 0.5rem 0;
      padding: 0.3rem;
      cursor: pointer;
      border-radius: 4px;
    }
    .team:hover {
      background: #e0e0e0;
    }
    .winner {
      background: #2e7d32;
      color: white;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <header>
    <h1>BKCS Croquet Tournament Bracket</h1>
  </header>
  <div class="bracket-container" id="bracket-container"></div>
  <svg id="bracket-lines"></svg>

  <script>
    let teams = [];
    let tournament = [];

    async function loadData() {
      const response = await fetch("https://nickcreedon1.github.io/bkcs-bracket/data.json");
      if (response.ok) {
        const data = await response.json();
        teams = data.teams;
        tournament = data.tournament;
        renderBracket();
        drawLines();
      } else {
        console.error("Failed to load data");
      }
    }

    function renderBracket() {
      const container = document.getElementById("bracket-container");
      container.innerHTML = "";
      tournament.forEach((round, rIdx) => {
        const roundDiv = document.createElement("div");
        roundDiv.className = "round";
        const title = document.createElement("h3");
        title.textContent = ["Round 1","Round 2","QF","SF","Final"][rIdx] || `Round ${rIdx+1}`;
        roundDiv.appendChild(title);
        round.forEach((match, mIdx) => {
          const matchDiv = document.createElement("div");
          matchDiv.className = "match";
          matchDiv.dataset.rIdx = rIdx;
          matchDiv.dataset.mIdx = mIdx;
          match.teams.forEach(team => {
            const teamDiv = document.createElement("div");
            teamDiv.className = "team";
            teamDiv.textContent = `${team.name} (${team.winningPercentage}%)`;
            if (match.winner === team.name) {
              teamDiv.classList.add("winner");
            }
            teamDiv.onclick = () => {
              match.winner = team.name;
              advanceWinner(rIdx, mIdx, team.name);
              renderBracket();
              drawLines();
            };
            matchDiv.appendChild(teamDiv);
          });
          roundDiv.appendChild(matchDiv);
        });
        container.appendChild(roundDiv);
      });
    }

    function advanceWinner(rIdx, mIdx, winnerName) {
      if (!tournament[rIdx+1]) return;
      const next = tournament[rIdx+1][Math.floor(mIdx/2)];
      const slot = mIdx % 2;
      if (next && next.teams[slot]) {
        next.teams[slot].name = winnerName;
      }
    }

    function drawLines() {
      const svg = document.getElementById("bracket-lines");
      svg.innerHTML = "";
      const rect = document.getElementById("bracket-container").getBoundingClientRect();
      svg.setAttribute("width", rect.width);
      svg.setAttribute("height", rect.height);
      document.querySelectorAll(".round").forEach((roundDiv, rIdx) => {
        if (!tournament[rIdx+1]) return;
        const nextRoundDiv = document.querySelectorAll(".round")[rIdx+1];
        roundDiv.querySelectorAll(".match").forEach((matchDiv, mIdx) => {
          const from = matchDiv.getBoundingClientRect();
          const nextMatchDiv = nextRoundDiv.querySelectorAll(".match")[Math.floor(mIdx/2)];
          if (!nextMatchDiv) return;
          const to = nextMatchDiv.getBoundingClientRect();
          const x1 = from.right - rect.left;
          const y1 = from.top + from.height/2 - rect.top;
          const x2 = to.left - rect.left;
          const y2 = to.top + to.height/2 - rect.top;
          const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
          line.setAttribute("x1", x1);
          line.setAttribute("y1", y1);
          line.setAttribute("x2", x2);
          line.setAttribute("y2", y2);
          line.setAttribute("stroke", "#bbb");
          line.setAttribute("stroke-width", "2");
          svg.appendChild(line);
        });
      });
    }

    window.addEventListener('resize', drawLines);
    loadData();
  </script>
</body>
</html>
